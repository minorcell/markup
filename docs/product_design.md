# MarkUp，一款MarkDown编辑器；

## 🌿 产品设计文档 - **MarkEdit**（基于 Fyne 的本地 Markdown 编辑器）

### 一、产品目标

构建一个本地运行、轻量、响应迅速的 Markdown 编辑器，面向开发者、写作者与记录型用户。强调简洁界面、清晰布局、快捷操作，提升专注写作体验。

---

### 二、核心功能概览

| 功能模块    | 描述                                                     |
| ------- | ------------------------------------------------------ |
| 文件管理    | - 从本地文件夹加载<br>- 新建、删除文件<br>- 支持右键菜单                    |
| 三栏界面    | - 左：文件树<br>- 中：目录结构（根据当前 Markdown 自动生成）<br>- 右：编辑器或预览区 |
| 编辑与预览模式 | - 编辑 Markdown<br>- 实时预览（或快捷键切换）                        |
| 导出      | - 导出为 HTML 或 PDF（PDF 可选）                               |
| 快捷键支持   | - Ctrl+E 切换编辑模式<br>- Ctrl+P 切换预览模式                     |

---

### 三、交互布局设计

```text
+------------------+----------------+---------------------------+
|     文件树       |   Markdown目录 |     编辑器 / 预览区       |
|   (左侧栏)       |   (中间栏)     |     (右侧主内容区)        |
+------------------+----------------+---------------------------+
```

* **文件树**：可展开、右键菜单（新建/删除/重命名）
* **目录栏**：基于当前 Markdown 文件的标题结构（#、##、###）动态更新
* **编辑区/预览区**：支持切换模式，预览区采用 Fyne RichText 渲染 markdown 内容

---

### 四、主要功能流程

#### 1. 打开文件夹

* 使用 `dialog.ShowFolderOpen` 选择根文件夹
* 遍历生成左侧树状视图（`widget.Tree`）

#### 2. 文件操作

* 新建文件：对选中文件夹右键，创建 `*.md` 文件
* 删除文件：对选中文件右键，执行删除（确认后）
* 文件切换：选中文件后加载到编辑器

#### 3. 编辑与预览

* 编辑器区：使用 `widget.Entry` + Vim-style 快捷键可选
* 预览区：使用 `fyne.Markdown`（或自行实现 markdown 渲染）
* Ctrl+E / Ctrl+P 切换模式（可通过 key binding 实现）

#### 4. 导出功能

* 导出为 HTML（markdown 解析后写入文件）
* 可选：PDF 使用 `canvas.Capture` 截图方式简易生成

---

### 五、技术架构 & 模块拆分

| 模块         | 技术要点                                        |
| ---------- | ------------------------------------------- |
| UI 框架      | Fyne UI 组件（Tree、Entry、Container）            |
| 文件操作       | Go 原生 `os`, `ioutil`，Fyne 的 dialog          |
| Markdown渲染 | 可用第三方库如 `github.com/gomarkdown/markdown`    |
| 快捷键支持      | `fyne.NewShortcut` + `fyne.ShortcutHandler` |
| 状态管理       | 全局状态 struct + Channel 事件派发                  |

---

### 六、开发最佳实践（基于 Fyne）

#### ✅ 使用容器组合管理布局

* 使用 `container.NewHSplit`, `container.NewVBox` 实现灵活布局
* 配置权重比例保证自适应

#### ✅ 最小状态变更更新 UI

* 编辑区、预览区切换：用 `Refresh()` 方法避免重建 UI
* 使用 `binding.String` 实现数据绑定与实时刷新

#### ✅ 响应式设计

* 利用 `Resize`, `OnSizeChanged` 实现适配不同分辨率
* 对于树、列表等组件加滚动容器 `container.NewVScroll()`

#### ✅ 文件操作安全性

* 加入文件存在检测
* 删除操作增加确认对话框

#### ✅ 快捷键与事件响应

* 注册 `fyne.Shortcut` 实现跨平台快捷键一致性
* 在 `canvas` 或 `window` 层面监听，避免局部失效

---

### 七、未来可扩展方向（Nice to Have）

* 自动保存草稿
* 文件搜索支持（模糊匹配）
* Git 同步/本地历史版本
* 可插拔插件架构
